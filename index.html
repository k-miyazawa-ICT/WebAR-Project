<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>AR.js Hiro Marker Sample</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; detectionMode: mono; debugUIEnabled: false;">
        <!-- Hiroマーカー -->
        <a-marker preset="hiro" smooth="true" smoothCount="5">
            <!-- 3Dモデル -->
            <a-entity id="myModel" gltf-model="https://k-miyazawa-ICT.github.io/WebAR-Project/model.glb" 
                      scale="8.6 8.6 8.6" 
                      rotation="90 0 0" 
                      position="0.7 -0.66 0">
            </a-entity>
        </a-marker>
        <a-camera position="0 0 0"></a-camera>
    </a-scene>

    <script>
        // A-Frameコンポーネントを作成して透明化
        AFRAME.registerComponent('set-transparent', {
    init: function () {
        let model = this.el;
        model.addEventListener('model-loaded', function () {
            console.log("✅ モデルがロードされました！（PC & スマホ）");
            let obj = model.getObject3D('mesh');  // Three.jsのオブジェクト取得
            if (obj) {
                obj.traverse((node) => {
                    if (node.isMesh) {
                        node.material.transparent = true;  // 透明有効化
                        node.material.opacity = 0.9;  // 透明度50%
                        node.material.depthWrite = false;  // スマホでの透明処理を強制
                        console.log("✅ 半透明 & depthWrite: false を適用しました！");
                    }
                });
            } else {
                console.log("❌ obj が null になっています！（スマホ？）");
            }
        });
    }
});



        // コンポーネントを3Dモデルに適用
        document.getElementById("myModel").setAttribute("set-transparent", "");
    </script>
</body>
</html>
