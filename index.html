<!DOCTYPE html>
<html>
<head>
  <!-- A-Frameの安定バージョンを使用 -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <!-- AR.jsの最新安定バージョンを使用 -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: true; trackingMethod: best; detectionMode: mono_and_matrix;">
    <a-marker type="barcode" value="0" id="marker">
      <a-entity id="model"
          position="0 0 0"
          scale="1 1 1" <!-- リアルサイズでテスト -->
          rotation="90 0 0"
          visible="false"></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    const marker = document.querySelector("#marker");
    const model = document.querySelector("#model");
    let isModelLoaded = false;

    marker.addEventListener("markerFound", () => {
      console.log("✅ マーカーを検出しました！3Dモデルを読み込みます...");
      if (!isModelLoaded) {
        model.setAttribute("gltf-model", "https://k-miyazawa-ICT.github.io/WebAR-Project/model.glb");
        setTimeout(() => {
          model.setAttribute("visible", "true");
          console.log("✅ モデルを表示しました");
          alert("3Dモデルが表示されました！"); // 元の動作を維持
        }, 1000);
        isModelLoaded = true;
      }
    });

    model.addEventListener("model-loaded", () => {
      console.log("✅ 3Dモデルが正常に読み込まれました！");
    });

    model.addEventListener("error", (err) => {
      console.error("❌ 3Dモデルの読み込みに失敗しました:", err);
      alert("3Dモデルの読み込みに失敗しました！GLBのURLを確認してください。");
    });

    marker.addEventListener("markerLost", () => {
      console.log("❌ マーカーを見失いましたが、モデルは表示したままにします。");
    });
  </script>
</body>
</html>
