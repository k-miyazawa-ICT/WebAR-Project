<!DOCTYPE html>
<html>
<head>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js@2.2.2/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: true; trackingMethod: best;">
    <!-- ArUcoマーカー（ID: 0）を使用 -->
    <a-marker type="barcode" value="0" id="marker">
      <a-entity id="model" 
          gltf-model="https://k-miyazawa-ICT.github.io/WebAR-Project/model.glb"
          position="0 0 -2"
          scale="100 100 100"
          rotation="90 0 0"
          visible="false"></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    let marker = document.querySelector("#marker");
    let model = document.querySelector("#model");

    marker.addEventListener("markerFound", () => {
      console.log("✅ ArUcoマーカー認識しました！3Dモデルを読み込みます...");
      alert("ArUcoマーカーが認識されました！3Dモデルを読み込みます...");

      setTimeout(() => {
        model.setAttribute("visible", "true");

        // マーカーの座標を取得して、そのまま固定
        let position = model.getAttribute("position");
        let rotation = model.getAttribute("rotation");
        model.setAttribute("position", position); // 位置を固定
        model.setAttribute("rotation", rotation); // 回転を固定

        // マーカーが不要になったら、マーカーとの紐付けを解除
        model.removeAttribute("markerhandler");
      }, 1000);
    });

    model.addEventListener("model-loaded", () => {
      console.log("✅ 3Dモデルが正常に読み込まれました！");
      alert("3Dモデルが表示されました！");
    });

    model.addEventListener("error", (err) => {
      console.log("❌ 3Dモデルの読み込みに失敗しました！", err);
      alert("3Dモデルの読み込みに失敗しました！GLBファイルのURLを確認してください。");
    });

    // ❌ マーカーを見失ったときの処理を削除！
  </script>
</body>
</html>
