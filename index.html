<button id="startAR">ARを開始</button>
<script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/loaders/GLTFLoader.js';

    let scene, camera, renderer, model;
    let xrSession = null;

    async function initAR() {
        if (!navigator.xr) {
            alert("WebXR未対応のブラウザです。");
            return;
        }

        // WebXRセッション開始
        xrSession = await navigator.xr.requestSession("immersive-ar", {
            requiredFeatures: ['hit-test']
        });

        // WebGLコンテキスト設定
        const gl = document.createElement("canvas").getContext("webgl");
        renderer = new THREE.WebGLRenderer({ alpha: true, context: gl });
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);

        // シーンのセットアップ
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
        scene.add(camera);

        const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
        scene.add(light);

        // GLTFモデルの読み込み
        const loader = new GLTFLoader();
        loader.load("https://k-miyazawa-ict.github.io/WebAR-Project/model.glb", (gltf) => {
            model = gltf.scene;
            model.scale.set(0.5, 0.5, 0.5);
            scene.add(model);
        });

        // WebXRのレンダリングループ
        renderer.setAnimationLoop(() => {
            renderer.render(scene, camera);
        });
    }

    document.getElementById("startAR").addEventListener("click", () => {
        initAR();
    });
</script>
